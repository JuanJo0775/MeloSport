{% extends "backoffice/base_backoffice.html" %}
{% load static %}
{% block title %}Historial de Reportes{% endblock %}

{% block breadcrumb %}
  {% load breadcrumbs %}
  <nav aria-label="breadcrumb" class="breadcrumb-wrapper">
    <ol class="breadcrumb small mb-2">
      {% breadcrumb "Reportes|backoffice:reports:definition_list" "Historial de reportes generados" %}
    </ol>
  </nav>
{% endblock %}

{% block content %}
<div class="container-fluid">

  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h3 class="mb-0">
        <i class="bi bi-clock-history me-2 text-primary"></i>
        Historial de reportes generados
      </h3>
      <div class="d-flex gap-2">
        <a href="{% url 'backoffice:reports:definition_list' %}" class="btn btn-light">
          <i class="bi bi-arrow-left"></i> Volver a reportes
        </a>
      </div>
    </div>
  </div>

  <!-- Tabla de reportes -->
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-primary">
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Reporte</th>
              <th scope="col">Usuario</th>
              <th scope="col">Fecha</th>
              <th scope="col">Estado</th>
              <th scope="col">Formato</th>
              <th scope="col" class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for report in generated %}
              <tr>
                <td>{{ report.pk }}</td>
                <td>{{ report.report_label }}</td>
                <td>{{ report.generated_by.username|default:"-" }}</td>
                <td>{{ report.created_at|date:"Y-m-d H:i" }}</td>
                <td>
                  <span class="badge 
                    {% if report.status == 'completed' %} bg-success
                    {% elif report.status == 'failed' %} bg-danger
                    {% elif report.status == 'running' %} bg-warning text-dark
                    {% else %} bg-secondary {% endif %}">
                    {{ report.get_status_display }}
                  </span>
                </td>
                <td>{{ report.format|upper }}</td>
                <td class="text-end">
                  <a href="{% url 'backoffice:reports:generated_detail' report.pk %}"
                     class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-eye"></i>
                  </a>
                  {% if report.file %}
                  <a href="{% url 'backoffice:reports:generated_download' report.pk %}"
                     class="btn btn-sm btn-primary">
                    <i class="bi bi-download"></i>
                  </a>
                  {% endif %}
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted py-4">
                  <i class="bi bi-inbox"></i> No hay reportes generados a√∫n.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
