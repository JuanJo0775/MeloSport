{% extends "backoffice/base_backoffice.html" %}
{% load breadcrumbs %}

{% block title %}Actualizar Usuario{% endblock %}

{% block breadcrumb %}
  {% breadcrumb  "Usuarios|backoffice:users:list" "Actualizar" %}
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-white border-bottom">
          <div class="d-flex align-items-center">
            <i class="bi bi-person-gear text-primary me-2" style="font-size: 1.25rem;"></i>
            <h5 class="mb-0 fw-semibold">Actualizar Usuario: {{ object.username }}</h5>
          </div>
        </div>
        <div class="card-body p-4">
          {% if form.errors %}
            <div class="alert alert-danger border-left-danger mb-4">
              <i class="bi bi-exclamation-triangle me-2"></i>
              <strong>Error:</strong> Por favor corrige los errores indicados.
            </div>
          {% endif %}

          <form method="post" novalidate>
            {% csrf_token %}

            <div class="row mb-4">
              <div class="col-md-6 mb-3">
                <label for="{{ form.username.id_for_label }}" class="form-label fw-medium">
                  <i class="bi bi-person me-1"></i> Usuario *
                </label>
                {{ form.username }}
                {% if form.username.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.username.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>

              <div class="col-md-6 mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label fw-medium">
                  <i class="bi bi-envelope me-1"></i> Correo electrónico *
                </label>
                {{ form.email }}
                {% if form.email.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.email.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-md-6 mb-3">
                <label for="{{ form.first_name.id_for_label }}" class="form-label fw-medium">
                  <i class="bi bi-card-text me-1"></i> Nombre
                </label>
                {{ form.first_name }}
                {% if form.first_name.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.first_name.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>

              <div class="col-md-6 mb-3">
                <label for="{{ form.last_name.id_for_label }}" class="form-label fw-medium">
                  <i class="bi bi-card-text me-1"></i> Apellido
                </label>
                {{ form.last_name }}
                {% if form.last_name.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.last_name.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-md-6 mb-3">
                <label for="{{ form.phone.id_for_label }}" class="form-label fw-medium">
                  <i class="bi bi-telephone me-1"></i> Teléfono *
                </label>
                {{ form.phone }}
                {% if form.phone.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.phone.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>

              <div class="col-md-6 mb-3">
                <label for="{{ form.role.id_for_label }}" class="form-label fw-medium">
                  <i class="bi bi-shield-check me-1"></i> Rol
                </label>
                {{ form.role }}
                {% if form.role.errors %}
                  <div class="invalid-feedback d-block">
                    {% for error in form.role.errors %}{{ error }}{% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-12">
                <div class="form-check">
                  {{ form.is_active }}
                  <label class="form-check-label fw-medium" for="{{ form.is_active.id_for_label }}">
                    <i class="bi bi-check-circle me-1"></i> Usuario activo
                  </label>
                  {% if form.is_active.errors %}
                    <div class="invalid-feedback d-block">
                      {% for error in form.is_active.errors %}{{ error }}{% endfor %}
                    </div>
                  {% endif %}
                </div>
                <small class="text-muted">Los usuarios inactivos no pueden iniciar sesión en el sistema</small>
              </div>
            </div>

            <hr class="my-4">

            <div class="d-flex gap-2 flex-wrap">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-lg me-1"></i> Actualizar Usuario
              </button>
              <a href="{% url 'backoffice:users:list' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i> Volver
              </a>
            </div>
          </form>
        </div>
      </div>

      <!-- Panel de información adicional -->
      <div class="card shadow-sm mt-4">
        <div class="card-header bg-light">
          <h6 class="mb-0"><i class="bi bi-info-circle me-1"></i> Información del sistema</h6>
        </div>
        <div class="card-body">
          <div class="row text-sm">
            <div class="col-md-4">
              <strong>Fecha de registro:</strong><br>
              <span class="text-muted">{{ object.date_joined|date:"d/m/Y H:i" }}</span>
            </div>
            <div class="col-md-4">
              <strong>Último acceso:</strong><br>
              <span class="text-muted">{{ object.last_login|date:"d/m/Y H:i"|default:"Nunca" }}</span>
            </div>
            <div class="col-md-4">
              <strong>Estado:</strong><br>
              {% if object.is_active %}
                <span class="badge badge-success">Activo</span>
              {% else %}
                <span class="badge badge-danger">Inactivo</span>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}