{% extends "backoffice/base_backoffice.html" %}
{% load breadcrumbs %}
{% load money %}

{% block title %}Apartados - Facturaci√≥n{% endblock %}

{% block breadcrumb %}
  {% breadcrumb "Apartados" %}
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="card">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div>
        <h5 class="mb-0">Apartados</h5>
        <small class="text-muted">Listado de apartados registrados</small>
      </div>
      <div>
        {% if perms.billing.add_reservation %}
        <a href="{% url 'backoffice:billing:reservation_create' %}" class="btn btn-primary">
          <i class="bi bi-plus-circle me-1"></i>Nuevo apartado
        </a>
        {% endif %}
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-striped mb-0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Abono</th>
            <th>Vence</th>
            <th>Estado</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for reservation in reservations %}
          <tr>
            <td>{{ reservation.id }}</td>
            <td>
              {{ reservation.client_first_name }} {{ reservation.client_last_name }}
              {% if not reservation.client_first_name and not reservation.client_last_name %}
                <small class="text-muted d-block">{{ reservation.client_phone }}</small>
              {% endif %}
            </td>
            <td>{{ reservation.amount_deposited|cop }}</td>
            <td>{{ reservation.due_date|date:"Y-m-d" }}</td>
            <td>
              {% if reservation.status == "active" %}
                <span class="badge bg-success">Activo</span>
              {% elif reservation.status == "completed" %}
                <span class="badge bg-secondary">Completado</span>
              {% elif reservation.status == "cancelled" %}
                <span class="badge bg-danger">Cancelado</span>
              {% else %}
                <span class="badge bg-warning text-dark">Expirado</span>
              {% endif %}
            </td>
            <td class="text-end">
              <a class="btn btn-sm btn-outline-primary" href="{% url 'backoffice:billing:reservation_detail' reservation.pk %}">
                <i class="bi bi-eye me-1"></i>Detalle
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">No hay apartados registrados.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
